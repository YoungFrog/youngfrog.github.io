<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta property="og:title" content="Netbeans, maven, jansi et des bugs" />
    <meta property="og:site_name" content="Le journal de YoungFrog" />
    <meta property="og:description" content="Au fil du temps j'ai noté des bugs avec Netbeans... je les consigne ici" />
    
    <meta property="og:type" content="article" />
    <meta property="og:author:username" content="youngfrog" />
    
    <meta property="og:image" content="https://youngfrog.lavnir.be/pics/DSC00035_mod_400x400.JPG">
    
    <meta property="og:url" content="https://youngfrog.lavnir.be/informatique/2021/11/25/netbeans-maven-jansi-et-des-bugs.html">
    
    <meta property="article:tag" content="informatique">
    
    <title>Netbeans, maven, jansi et des bugs</title>
    <meta name="description" content="Les errements de ma pensée, parfois nus, parfois enrobés. Mes écrits n'engagent que ceux qui y croient, mais pas trop.">
    <meta property="fb:app_id" content="237195747511348"/>

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://youngfrog.lavnir.be/informatique/2021/11/25/netbeans-maven-jansi-et-des-bugs.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Le journal de YoungFrog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About -- À propos</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/category/jepensetouthaut/">jepensetouthaut</a>
          
        
          
          <a class="page-link" href="/category/informatique/">informatique</a>
          
        
          
          <a class="page-link" href="/category/enseignement/">enseignement</a>
          
        
          
          <a class="page-link" href="/category/blog/">blog</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Netbeans, maven, jansi et des bugs</h1>
    <p class="post-meta">Nov 25, 2021</p>
    
     <blockquote>Résumé : Au fil du temps j'ai noté des bugs avec Netbeans... je les consigne ici</blockquote> 
    
  </header>

  <article class="post-content">
      <ul>
  <li><a href="#acte-1--les-couleurs-disparaissent">Acte 1 : les couleurs disparaissent</a>
    <ul>
      <li><a href="#test-case">Test case:</a></li>
      <li><a href="#fix">Fix</a></li>
      <li><a href="#non-fix">Non-fix</a></li>
      <li><a href="#versions-concernées">Versions concernées</a></li>
      <li><a href="#ressources">Ressources</a></li>
    </ul>
  </li>
  <li><a href="#acte-2--le-prompt-saffiche-après-la-réponse">Acte 2 : Le “prompt” s’affiche après la réponse</a>
    <ul>
      <li><a href="#test-case-1">Test case:</a></li>
      <li><a href="#fix-1">Fix</a></li>
      <li><a href="#ressources-1">Ressources</a></li>
    </ul>
  </li>
  <li><a href="#acte-3--les-caractères-ne-saffichent-pas-tous-point-dinterrogation">Acte 3 : Les caractères ne s’affichent pas tous (point d’interrogation)</a>
    <ul>
      <li><a href="#test-case-2">Test case:</a></li>
      <li><a href="#fix-2">Fix</a></li>
    </ul>
  </li>
</ul>


      <h1 id="acte-1--les-couleurs-disparaissent">Acte 1 : les couleurs disparaissent</h1>

<p>Premier bug remarqué il y a bien longtemps, les couleurs dans Netbeans (en affichant les code ANSI dans la console) ont disparu.</p>

<p>C’est <code class="language-plaintext highlighter-rouge">jansi</code> qui enlève les codes couleur, et c’est probablement lié au fait qu’il (jansi) ne détecte pas (pas bien?) la console Netbeans comme étant capable d’afficher les couleurs. 
(J’ai bien envie de rejeter la faute sur Netbeans.)</p>

<h2 id="test-case">Test case:</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">String</span> <span class="no">ANSI_RED</span> <span class="o">=</span> <span class="s">"\u001B[31m"</span><span class="o">;</span>
<span class="kd">final</span> <span class="nc">String</span> <span class="no">ANSI_RESET</span> <span class="o">=</span> <span class="s">"\u001B[0m"</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Are we "</span> <span class="o">+</span> <span class="no">ANSI_RED</span> <span class="o">+</span> <span class="s">"colouring"</span> <span class="o">+</span> <span class="no">ANSI_RESET</span> <span class="o">+</span> <span class="s">" ?"</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="fix">Fix</h2>

<p>Le fix est relativement simple et pourtant méconnu : virer <code class="language-plaintext highlighter-rouge">jansi</code>. Pour ce faire je fais simplement <code class="language-plaintext highlighter-rouge">chmod -r /path/to/netbeans/java/maven/lib/jansi*</code> et hop!</p>

<p>Sinon bien sûr, lancer hors de Netbeans:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn <span class="s2">"-Dexec.args=-classpath %classpath pack.age.MyClass"</span> <span class="nt">-Dexec</span>.executable<span class="o">=</span>java <span class="nb">exec</span>:exec
<span class="c"># ou alors</span>
mvn <span class="nt">-Dexec</span>.mainClass<span class="o">=</span>pack.age.MyClass <span class="nb">exec</span>:java
</code></pre></div></div>

<h2 id="non-fix">Non-fix</h2>

<p>Un idée qui revient est de définir <code class="language-plaintext highlighter-rouge">MAVEN_OPTS=-Djansi.passthrough=true</code> mais cela casse d’autres choses, telles que les liens dans les backtraces ou (de mémoire) les tests unitaires.</p>

<h2 id="versions-concernées">Versions concernées</h2>

<p>jansi a été intégré à Maven avec Maven 3.5.0 ; et ce Maven a été intégré à Netbeans avec Netbeans 12.2.
À ma connaissance le bug n’est pas résolu depuis.</p>

<h2 id="ressources">Ressources</h2>
<ul>
  <li><a href="https://issues.apache.org/jira/browse/MNG-6205?focusedCommentId=15956355&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15956355">https://issues.apache.org/jira/browse/MNG-6205?focusedCommentId=15956355&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15956355</a> (j’ai réalisé le fix en lisant ceci)</li>
  <li><a href="https://stackoverflow.com/questions/26425981/colored-output-in-netbeans-console-with-ansicodes/51508523#51508523">https://stackoverflow.com/questions/26425981/colored-output-in-netbeans-console-with-ansicodes/51508523#51508523</a></li>
  <li><a href="https://issues.apache.org/jira/browse/NETBEANS-3047">https://issues.apache.org/jira/browse/NETBEANS-3047</a> – il faudrait transférer ce bug vers <a href="https://github.com/apache/netbeans/issues/new">github</a></li>
  <li><a href="https://issues.apache.org/jira/browse/MNG-6417">https://issues.apache.org/jira/browse/MNG-6417</a></li>
</ul>

<!-- Ressources internes:
https://groups.google.com/u/0/a/he2b.be/g/esi-dev2-list/c/Pzjiioj0_T8/m/4GlJ0AQFAwAJ
-->

<h1 id="acte-2--le-prompt-saffiche-après-la-réponse">Acte 2 : Le “prompt” s’affiche après la réponse</h1>

<h2 id="test-case-1">Test case:</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"The prompt should come... but it won't."</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Say something: "</span><span class="o">);</span>
<span class="o">(</span><span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">)).</span><span class="na">next</span><span class="o">();</span>
</code></pre></div></div>

<h2 id="fix-1">Fix</h2>

<p>Résolu dans Netbeans 14 !</p>

<p>Le fix est d’utiliser une version pas trop vieille de jansi (after 1.3.2 si j’ai bien compris).
Copier le fichier .jar devrait marcher.
Une autre option est de ne pas utiliser jansi du tout, comme dans le point précédent</p>

<h2 id="ressources-1">Ressources</h2>

<ul>
  <li><a href="https://mvnrepository.com/artifact/org.fusesource.jansi/jansi">https://mvnrepository.com/artifact/org.fusesource.jansi/jansi</a> – le jar est dispo</li>
  <li><a href="https://github.com/fusesource/jansi/">https://github.com/fusesource/jansi/</a></li>
  <li><a href="https://fusesource.github.io/jansi/download.html">https://fusesource.github.io/jansi/download.html</a> – je pense que ce sont les anciennes releases</li>
  <li><a href="https://github.com/mojohaus/exec-maven-plugin/issues/159">https://github.com/mojohaus/exec-maven-plugin/issues/159</a></li>
  <li><a href="https://github.com/mojohaus/exec-maven-plugin/issues/155">https://github.com/mojohaus/exec-maven-plugin/issues/155</a></li>
  <li><a href="https://github.com/mojohaus/exec-maven-plugin/issues/154">https://github.com/mojohaus/exec-maven-plugin/issues/154</a></li>
  <li><a href="https://issues.apache.org/jira/browse/NETBEANS-4453">https://issues.apache.org/jira/browse/NETBEANS-4453</a></li>
  <li><a href="https://issues.apache.org/jira/browse/MNG-6239">https://issues.apache.org/jira/browse/MNG-6239</a></li>
</ul>

<!-- https://groups.google.com/u/0/a/he2b.be/g/esi-dev2-list/c/yOZlTi4qtyQ/m/zrbW_8T_AwAJ -->

<h1 id="acte-3--les-caractères-ne-saffichent-pas-tous-point-dinterrogation">Acte 3 : Les caractères ne s’affichent pas tous (point d’interrogation)</h1>

<p>Ici tout se passe comme si l’encodage était mauvais.</p>

<p>Exemple 𐐷 (DESERET SMALL LETTER YEE) ne s’affiche pas bien chez moi. Mais en fait même “é” ou “€” ne s’affichent pas bien.</p>

<p>Le problème n’apparait chez moi que avec Maven lancé sous Netbeans. Si je lance dans un terminal ou si j’utilise ant ou gradle, ça fonctionne.</p>

<h2 id="test-case-2">Test case:</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">do</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Byte: "</span> <span class="o">+</span> <span class="n">read</span><span class="o">);</span>
<span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">available</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
</code></pre></div></div>

<p>Avec Maven sous Netbeans, un é (e accent aigu) va afficher:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Byte: 233
Byte: 10
</code></pre></div></div>

<p>Alors que hors Netbeans ça donnera :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Byte: 195
Byte: 169
Byte: 10
</code></pre></div></div>

<p>Si je teste avec 𐐷 (DESERET SMALL LETTER YEE), ça donne:</p>

<p>Avec Netbeans:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Byte: 1
Byte: 55
Byte: 10
</code></pre></div></div>

<p>Hors Netbeans:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Byte: 240
Byte: 144
Byte: 144
Byte: 183
Byte: 10
</code></pre></div></div>

<p>Hors Netbeans c’est l’encodage UTF8 utilisé.Sous Netbeans on dirait de l’UTF16, mais il manque un octet sur deux puisque DESERET SMALL LETTER YEE <a href="https://www.fileformat.info/info/unicode/char/10437/charset_support.htm">s’encode avec 216 1 220 55 – c’est-à-dire d8 01 dc 37</a> normalement.</p>

<h2 id="fix-2">Fix</h2>

<p>Ceci est corrigé avec Netbeans 14 !</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Le journal de YoungFrog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Le journal de YoungFrog</li>
          <li><a href="mailto:nrichard@members.fsf.org">nrichard@members.fsf.org</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/youngfrog">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">youngfrog</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/youngfrog">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">youngfrog</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Les errements de ma pensée, parfois nus, parfois enrobés. Mes écrits n'engagent que ceux qui y croient, mais pas trop.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
